CREATE TABLE GENDER_DB.MALE_EMPLOYMENT_TRANSPOSED (CountryName varchar(50), IndicatorCode varchar(30), YearsByCountry INTEGER, DATA FLOAT );

DELIMITER $$
CREATE PROCEDURE GENDER_DB.MALE_EMPLOYMENT_TRANSPOSED(MIN_VALUE INTEGER, MAX_VALUE INTEGER)
BEGIN

DECLARE YEAR INTEGER;
DECLARE COLNAME varchar(50);
SET YEAR = MIN_VALUE;

WHILE YEAR <= MAX_VALUE 
DO

SET @COLNAME = CONCAT('`',YEAR,'`');
SET @STATEMENT = CONCAT(
    'INSERT INTO GENDER_DB.MALE_EMPLOYMENT_TRANSPOSED (CountryName, IndicatorCode, YearsByCountry, Data)',
    ' SELECT CountryName, IndicatorCode, ', YEAR,',', @COLNAME,
    ' FROM GENDER_DB.gender_data',
    ' WHERE ', @COLNAME,
    ' IS NOT NULL'
);

PREPARE STMT FROM @STATEMENT;
EXECUTE STMT;
DEALLOCATE PREPARE STMT;

SET YEAR = YEAR + 1;
END WHILE;
END$$
DELIMITER ;

CALL GENDER_DB.MALE_EMPLOYMENT_TRANSPOSED(2010,2016);

-- VIEWS for Hive and Pig (respectively)

CREATE VIEW Q3_MALE_EMP AS
SELECT CountryName, IndicatorCode, YearsByCountry, Data
FROM MALE_EMPLOYMENT_TRANSPOSED
WHERE IndicatorCode = 'SL.EMP.SELF.MA.ZS';